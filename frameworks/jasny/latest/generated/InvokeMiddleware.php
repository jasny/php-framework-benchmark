<?php

namespace App\Generated;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\MiddlewareInterface;
use Psr\Http\Server\RequestHandlerInterface;
use Psr\Http\Message\ResponseFactoryInterface;

/**
 * PSR-15 compatible middleware that invokes an action based on the route attributes of the server request.
 *
 * This file is generated by SwitchRoute.
 * Do not modify it manually. Any changes will be overwritten.
 */
class InvokeMiddleware implements MiddlewareInterface
{
    /**
     * @var ResponseFactoryInterface
     */
    protected $responseFactory;

    /**
     * @var callable
     */
    protected $instantiate;

    /**
     * @param ResponseFactoryInterface $responseFactory  Used for default not-found response.
     * @param callable                 $instantiate      Instantiate controller / action classes.
     */
    public function __construct(ResponseFactoryInterface $responseFactory = null, ?callable $instantiate = null)
    {
        $this->responseFactory = $responseFactory;
        $this->instantiate = $instantiate;
    }

    /**
     * The default action for when no route matches.
     */
    protected function notFound(ServerRequestInterface $request): ResponseInterface
    {
        $allowedMethods = $request->getAttribute('route:allowed_methods', []);

        if ($allowedMethods === []) {
            $response = $this->responseFactory->createResponse(404)
                ->withHeader('Content-Type', 'text/plain');
            $response->getBody()->write('Not Found');
        } else {
            $response = $this->responseFactory->createResponse(405)
                ->withHeader('Content-Type', 'text/plain')
                ->withHeader('Allow', join(', ', $allowedMethods));
            $response->getBody()->write('Method Not Allowed');
        }

        return $response;
    }

    /**
     * Process an incoming server request.
     */
    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface
    {
        $include = $request->getAttribute('route:include', null);
        if ($include !== null) {
            return require $include;
        }

        $controller = $request->getAttribute('route:controller', '');
        $action = $request->getAttribute('route:action', '');

        switch ($controller) {
            case 'index':
                switch ($action) {
                    case '':
                        return (isset($this->instantiate) ? ($this->instantiate)('App\IndexController') : new \App\IndexController)->defaultAction();
                }
                break;
            case 'hello':
                switch ($action) {
                    case '':
                        return (isset($this->instantiate) ? ($this->instantiate)('App\HelloController') : new \App\HelloController)->defaultAction();
                }
                break;
            case '':
                switch ($action) {
                    case '':
                        return $this->notFound($request);
                }
                break;
        }

$this->notFound($request);
    }
}
